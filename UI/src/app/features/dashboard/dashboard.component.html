<div class="dashboard-container">
  <aside class="sidebar" [class.open]="sidebarOpen" [class.handset]="isHandset">
    <app-controls-panel
      [datasets]="datasets"
      [algorithms]="algorithms"
      [config]="config"
      (run)="onRun($event)"
      (reset)="onReset()"
      (export)="onExport($event)"
      (configChange)="onConfigChanged($event)"
    ></app-controls-panel>
  </aside>

  <div class="dashboard-main">
    <header class="top-bar">
      <button type="button" class="menu-button" (click)="toggleSidebar()" *ngIf="isHandset">☰</button>
      <span class="title">CVRP Explorer</span>
      <span class="status">Mock frontend only ⛅</span>
    </header>

    <div *ngIf="toastMessage" class="toast">{{ toastMessage }}</div>

    <div class="loading-bar" *ngIf="isSolving">
      <div class="indicator"></div>
    </div>

    <div class="content">
      <div class="grid gap-6 xl:grid-cols-[2fr,1fr]">
        <app-map-view
          class="min-h-[320px]"
          [depot]="instance?.depot ?? null"
          [customers]="instance?.customers ?? []"
          [routes]="routes"
          [highlightVehicle]="highlightVehicle"
          [utilization]="utilization"
        ></app-map-view>

        <div class="flex flex-col gap-4">
          <app-metrics-cards [metrics]="metrics"></app-metrics-cards>
          <div class="tabs">
            <div class="tab-buttons">
              <button type="button" [class.active]="activeTab === 'routes'" (click)="selectTab('routes')">
                Routes
              </button>
              <button type="button" [class.active]="activeTab === 'compare'" (click)="selectTab('compare')">
                Compare
              </button>
              <button type="button" [class.active]="activeTab === 'log'" (click)="selectTab('log')">
                Run log
              </button>
            </div>
            <div class="tab-panel" *ngIf="activeTab === 'routes'">
              <app-routes-tab
                class="block"
                [routes]="routes"
                [highlightVehicle]="highlightVehicle"
                (highlightChange)="onHighlightChange($event)"
              ></app-routes-tab>
            </div>
            <div class="tab-panel" *ngIf="activeTab === 'compare'">
              <app-compare-tab
                class="block"
                [convergence]="solution?.convergence"
                [runtimeBreakdown]="solution?.runtimeBreakdown"
              ></app-compare-tab>
            </div>
            <div class="tab-panel" *ngIf="activeTab === 'log'">
              <app-run-log-tab class="block" [log]="solution?.log"></app-run-log-tab>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="backdrop" *ngIf="isHandset && sidebarOpen" (click)="toggleSidebar()"></div>
</div>
